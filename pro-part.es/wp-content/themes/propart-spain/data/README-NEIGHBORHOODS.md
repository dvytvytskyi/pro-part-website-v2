# üèòÔ∏è –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ —Ä–∞–π–æ–Ω—ñ–≤ Costa del Sol

## üìã –û–ø–∏—Å

–°–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –±–∞–≥–∞—Ç–æ—Ä—ñ–≤–Ω–µ–≤–∏—Ö –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ —Ä–∞–π–æ–Ω—ñ–≤ Costa del Sol –Ω–∞ –∫–∞—Ä—Ç—ñ Mapbox –∑ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—é –ø–æ–∫–∞–∑—É/–ø—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è —Ç–∞ —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—ó –≤–∑–∞—î–º–æ–¥—ñ—ó.

## üéØ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä—ñ–≤–Ω—ñ–≤

### –†—ñ–≤–µ–Ω—å 1: Costa del Sol (—Ä–µ–≥—ñ–æ–Ω)
- –ó–∞–≥–∞–ª—å–Ω–∏–π –ø–æ–ª—ñ–≥–æ–Ω –≤—Å—å–æ–≥–æ —Ä–µ–≥—ñ–æ–Ω—É Costa del Sol
- –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –ø—Ä–∏ zoom < 11
- –ö–æ–ª—ñ—Ä: –±—ñ—Ä—é–∑–æ–≤–∏–π (#088)

### –†—ñ–≤–µ–Ω—å 2: –ú—ñ—Å—Ç–∞
- Estepona, Marbella, Fuengirola, Mijas, Benalm√°dena, —Ç–∞ —ñ–Ω—à—ñ
- –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –ø—Ä–∏ zoom >= 9
- –ö–æ–ª—ñ—Ä: —Å–∏–Ω—ñ–π (#4a90e2)
- –ú–∞—î –ø—ñ–¥–ø–∏—Å–∏ (labels)

### –†—ñ–≤–µ–Ω—å 3: –†–∞–π–æ–Ω–∏ (neighborhoods)
- –†–∞–π–æ–Ω–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –º—ñ—Å—Ç (Puerto Ban√∫s, Nueva Andaluc√≠a, Sierra Blanca, —Ç–æ—â–æ)
- –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –ø—Ä–∏ zoom >= 11
- –ö–æ–ª—ñ—Ä: —á–µ—Ä–≤–æ–Ω–∏–π (#ff6b6b)
- –ú–∞—î –ø—ñ–¥–ø–∏—Å–∏ (labels)
- –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ñ (hover, click)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

```
wp-content/themes/propart-spain/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ geojson/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ level-1-region.geojson          # Costa del Sol (—Ä–µ–≥—ñ–æ–Ω)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ level-2-cities.geojson          # –ú—ñ—Å—Ç–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ level-3-neighborhoods.geojson   # –†–∞–π–æ–Ω–∏
‚îÇ   ‚îî‚îÄ‚îÄ README-NEIGHBORHOODS.md
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ fetch-neighborhoods-geojson.php     # –ü–æ–≤–Ω–∏–π —Å–∫—Ä–∏–ø—Ç (Overpass API)
‚îÇ   ‚îî‚îÄ‚îÄ fetch-neighborhoods-quick.php       # –®–≤–∏–¥–∫–∞ –≤–µ—Ä—Å—ñ—è (Nominatim API)
‚îî‚îÄ‚îÄ pages/
    ‚îî‚îÄ‚îÄ map.php                              # –ö–∞—Ä—Ç–∞ –∑ —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–º–∏ –ø–æ–ª—ñ–≥–æ–Ω–∞–º–∏
```

## üöÄ –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏

### –ù–∞ –∫–∞—Ä—Ç—ñ (–¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É –∫–∞—Ä—Ç–∏ `/map`
2. –ó–Ω–∞–π–¥—ñ—Ç—å –∫–Ω–æ–ø–∫—É **"Neighborhoods"** –±—ñ–ª—è –∫–Ω–æ–ø–∫–∏ "Draw on map"
3. –ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É - –ø–æ–ª—ñ–≥–æ–Ω–∏ –∑'—è–≤–ª—è—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç—ñ
4. –ó–º—ñ–Ω—é–π—Ç–µ zoom:
   - Zoom 8-10: –±–∞—á–∏—Ç–µ –∑–∞–≥–∞–ª—å–Ω–∏–π —Ä–µ–≥—ñ–æ–Ω Costa del Sol
   - Zoom 9-12: –±–∞—á–∏—Ç–µ –º—ñ—Å—Ç–∞ –∑ –ø—ñ–¥–ø–∏—Å–∞–º–∏
   - Zoom 11+: –±–∞—á–∏—Ç–µ —Ä–∞–π–æ–Ω–∏ –∑ –ø—ñ–¥–ø–∏—Å–∞–º–∏
5. –ù–∞–≤–µ–¥—ñ—Ç—å –º–∏—à–∫—É –Ω–∞ —Ä–∞–π–æ–Ω - –≤—ñ–Ω –ø—ñ–¥—Å–≤—ñ—Ç–∏—Ç—å—Å—è
6. –ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ —Ä–∞–π–æ–Ω - –≤ –∫–æ–Ω—Å–æ–ª—ñ –∑'—è–≤–∏—Ç—å—Å—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è (TODO: –¥–æ–¥–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é)

### –û–Ω–æ–≤–ª–µ–Ω–Ω—è GeoJSON –¥–∞–Ω–∏—Ö

#### –í–∞—Ä—ñ–∞–Ω—Ç 1: –®–≤–∏–¥–∫–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (Nominatim API)

```bash
cd /Users/vytvytskyi/Downloads/htdocs/pro-part.es/wp-content/themes/propart-spain/scripts
php fetch-neighborhoods-quick.php
```

**–ü–ª—é—Å–∏:**
- –®–≤–∏–¥–∫–æ (1-2 —Ö–≤–∏–ª–∏–Ω–∏)
- –ù–µ –ø–µ—Ä–µ–≤–∞–Ω—Ç–∞–∂—É—î API

**–ú—ñ–Ω—É—Å–∏:**
- –ü—Ä–∏–±–ª–∏–∑–Ω—ñ –ø–æ–ª—ñ–≥–æ–Ω–∏ (bbox)
- –ù–µ –≤—Å—ñ —Ä–∞–π–æ–Ω–∏ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è

#### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ü–æ–≤–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (Overpass API)

```bash
cd /Users/vytvytskyi/Downloads/htdocs/pro-part.es/wp-content/themes/propart-spain/scripts
php fetch-neighborhoods-geojson.php
```

**–ü–ª—é—Å–∏:**
- –¢–æ—á–Ω—ñ –ø–æ–ª—ñ–≥–æ–Ω–∏ –∑ OpenStreetMap
- –ë—ñ–ª—å—à–µ –¥–µ—Ç–∞–ª–µ–π

**–ú—ñ–Ω—É—Å–∏:**
- –î–æ–≤–≥–æ (30-60 —Ö–≤–∏–ª–∏–Ω —á–µ—Ä–µ–∑ –∑–∞—Ç—Ä–∏–º–∫–∏ –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏)
- –ú–æ–∂–µ –Ω–µ –∑–Ω–∞–π—Ç–∏ –¥–µ—è–∫—ñ –Ω–æ–≤—ñ —Ä–∞–π–æ–Ω–∏

#### –í–∞—Ä—ñ–∞–Ω—Ç 3: –†—É—á–Ω–µ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ —Ñ–∞–π–ª `data/geojson/level-3-neighborhoods.geojson`
2. –î–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π feature:

```json
{
  "type": "Feature",
  "properties": {
    "name": "–ù–∞–∑–≤–∞ —Ä–∞–π–æ–Ω—É",
    "type": "neighborhood",
    "parent": "–ú—ñ—Å—Ç–æ",
    "level": 3
  },
  "geometry": {
    "type": "Polygon",
    "coordinates": [
      [
        [lon1, lat1],
        [lon2, lat2],
        [lon3, lat3],
        [lon1, lat1]  // –∑–∞–º–∫–Ω—É—Ç–∏ –ø–æ–ª—ñ–≥–æ–Ω
      ]
    ]
  }
}
```

## üé® –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤

### –ó–º—ñ–Ω–∞ –∫–æ–ª—å–æ—Ä—ñ–≤

–í `map.php`, —Ñ—É–Ω–∫—Ü—ñ—è `initNeighborhoodLayers()`:

```javascript
// –†—ñ–≤–µ–Ω—å 1 (—Ä–µ–≥—ñ–æ–Ω)
'fill-color': '#088',        // –ó–º—ñ–Ω—ñ—Ç—å —Ç—É—Ç
'line-color': '#088',

// –†—ñ–≤–µ–Ω—å 2 (–º—ñ—Å—Ç–∞)
'fill-color': '#4a90e2',     // –ó–º—ñ–Ω—ñ—Ç—å —Ç—É—Ç
'line-color': '#4a90e2',

// –†—ñ–≤–µ–Ω—å 3 (—Ä–∞–π–æ–Ω–∏)
'fill-color': '#ff6b6b',     // –ó–º—ñ–Ω—ñ—Ç—å —Ç—É—Ç
'line-color': '#ff6b6b',
```

### –ó–º—ñ–Ω–∞ –ø—Ä–æ–∑–æ—Ä–æ—Å—Ç—ñ

```javascript
'fill-opacity': 0.15,  // 0.0 - 1.0
'line-opacity': 0.7,   // 0.0 - 1.0
```

### –ó–º—ñ–Ω–∞ —Ç–æ–≤—â–∏–Ω–∏ –ª—ñ–Ω—ñ–π

```javascript
'line-width': 2,  // –ø—ñ–∫—Å–µ–ª—ñ
```

### –ó–º—ñ–Ω–∞ zoom —Ä—ñ–≤–Ω—ñ–≤

–í —Ñ—É–Ω–∫—Ü—ñ—ó `updateNeighborhoodVisibilityByZoom()`:

```javascript
if (currentZoom < 11) {        // –ó–º—ñ–Ω—ñ—Ç—å —Ç—É—Ç –¥–ª—è —Ä—ñ–≤–Ω—è 1
if (currentZoom >= 9) {        // –ó–º—ñ–Ω—ñ—Ç—å —Ç—É—Ç –¥–ª—è —Ä—ñ–≤–Ω—è 2
if (currentZoom >= 11) {       // –ó–º—ñ–Ω—ñ—Ç—å —Ç—É—Ç –¥–ª—è —Ä—ñ–≤–Ω—è 3
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—Ç–æ—á–Ω–∏—Ö –¥–∞–Ω–∏—Ö

- **–†—ñ–≤–µ–Ω—å 1:** 1 –ø–æ–ª—ñ–≥–æ–Ω (Costa del Sol)
- **–†—ñ–≤–µ–Ω—å 2:** 5 –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ (Marbella, Estepona, Fuengirola, Mijas, Benalm√°dena)
- **–†—ñ–≤–µ–Ω—å 3:** 8 –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ (Puerto Ban√∫s, Nueva Andaluc√≠a, Sierra Blanca, —Ç–æ—â–æ)

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –¶–µ —Ç–µ—Å—Ç–æ–≤—ñ –¥–∞–Ω—ñ –∑ –ø—Ä–∏–±–ª–∏–∑–Ω–∏–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏. –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –æ–¥–∏–Ω –∑ —Å–∫—Ä–∏–ø—Ç—ñ–≤ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö.

## üîß API —Ñ—É–Ω–∫—Ü—ñ—ó

### JavaScript —Ñ—É–Ω–∫—Ü—ñ—ó (–≤ map.php)

```javascript
// –ü–æ–∫–∞–∑–∞—Ç–∏/–ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø–æ–ª—ñ–≥–æ–Ω–∏
toggleNeighborhoods()

// –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ GeoJSON –¥–∞–Ω—ñ
loadNeighborhoodPolygons()

// –ü–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–ª—ñ–≥–æ–Ω–∏
showNeighborhoods()

// –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –ø–æ–ª—ñ–≥–æ–Ω–∏
hideNeighborhoods()

// –û–Ω–æ–≤–∏—Ç–∏ –≤–∏–¥–∏–º—ñ—Å—Ç—å –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ zoom
updateNeighborhoodVisibilityByZoom()

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —à–∞—Ä–∏ –Ω–∞ –∫–∞—Ä—Ç—ñ
initNeighborhoodLayers()
```

### –ì–ª–æ–±–∞–ª—å–Ω—ñ –∑–º—ñ–Ω–Ω—ñ

```javascript
neighborhoodsVisible    // boolean - —á–∏ –ø–æ–∫–∞–∑–∞–Ω—ñ –ø–æ–ª—ñ–≥–æ–Ω–∏
neighborhoodsLoaded     // boolean - —á–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ –¥–∞–Ω—ñ
```

## üêõ Debugging

### –ö–æ–Ω—Å–æ–ª—å–Ω—ñ –ª–æ–≥–∏

–ü—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –ø–æ–ª—ñ–≥–æ–Ω–∞–º–∏ –≤ –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ:

```
üèòÔ∏è –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è —à–∞—Ä—ñ–≤ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ —Ä–∞–π–æ–Ω—ñ–≤...
‚úÖ –®–∞—Ä–∏ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
üèòÔ∏è –ö–ù–û–ü–ö–ê NEIGHBORHOODS –ù–ê–¢–ò–°–ù–£–¢–ê!
üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è GeoJSON –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤...
‚úÖ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤: {level1: 1, level2: 5, level3: 8}
üëÅÔ∏è –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–ª—ñ–≥–æ–Ω–∏ —Ä–∞–π–æ–Ω—ñ–≤
üèòÔ∏è –ö–ª—ñ–∫ –Ω–∞ —Ä–∞–π–æ–Ω: Puerto Ban√∫s ( Marbella )
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —à–∞—Ä—ñ–≤ –Ω–∞ –∫–∞—Ä—Ç—ñ

–í –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —ñ—Å–Ω—É—é—Ç—å –¥–∂–µ—Ä–µ–ª–∞
map.getSource('neighborhoods-level-1')
map.getSource('neighborhoods-level-2')
map.getSource('neighborhoods-level-3')

// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —ñ—Å–Ω—É—é—Ç—å —à–∞—Ä–∏
map.getLayer('neighborhoods-fill-1')
map.getLayer('neighborhoods-fill-2')
map.getLayer('neighborhoods-fill-3')

// –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–∞–Ω—ñ
map.getSource('neighborhoods-level-3').serialize()
```

## üìù TODO / –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏

- [ ] –î–æ–¥–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é –ø—Ä–æ–µ–∫—Ç—ñ–≤ –ø–æ –∫–ª—ñ–∫—É –Ω–∞ —Ä–∞–π–æ–Ω
- [ ] –î–æ–¥–∞—Ç–∏ breadcrumbs –Ω–∞–≤—ñ–≥–∞—Ü—ñ—é (—è–∫ –Ω–∞ Idealista)
- [ ] –û—Ç—Ä–∏–º–∞—Ç–∏ —Ä–µ–∞–ª—å–Ω—ñ GeoJSON –¥–∞–Ω—ñ –∑ OpenStreetMap –¥–ª—è –≤—Å—ñ—Ö —Ä–∞–π–æ–Ω—ñ–≤
- [ ] –î–æ–¥–∞—Ç–∏ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–±–æ—Ä—É –∫—ñ–ª—å–∫–æ—Ö —Ä–∞–π–æ–Ω—ñ–≤
- [ ] –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ —Å—Ç–∞–Ω –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤ –≤ URL
- [ ] –î–æ–¥–∞—Ç–∏ mobile-friendly —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
- [ ] –î–æ–¥–∞—Ç–∏ –∞–Ω—ñ–º–∞—Ü—ñ—é –ø—Ä–∏ zoom –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö
- [ ] –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ performance –¥–ª—è –≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –ø–æ–ª—ñ–≥–æ–Ω—ñ–≤

## ü§ù –î–æ–ø–æ–º–æ–≥–∞

–Ø–∫—â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å –ø—Ä–æ–±–ª–µ–º–∏:

1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —Ñ–∞–π–ª–∏ GeoJSON —ñ—Å–Ω—É—é—Ç—å —ñ –¥–æ—Å—Ç—É–ø–Ω—ñ
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ Mapbox —Ç–æ–∫–µ–Ω –≤–∞–ª—ñ–¥–Ω–∏–π
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ map —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ (`!!map` –≤ –∫–æ–Ω—Å–æ–ª—ñ)

## üìö –†–µ—Å—É—Ä—Å–∏

- [Mapbox GL JS Documentation](https://docs.mapbox.com/mapbox-gl-js/api/)
- [GeoJSON Specification](https://geojson.org/)
- [OpenStreetMap Overpass API](https://wiki.openstreetmap.org/wiki/Overpass_API)
- [Nominatim API](https://nominatim.org/release-docs/develop/api/Overview/)

---

**–ê–≤—Ç–æ—Ä:** AI Assistant  
**–î–∞—Ç–∞:** 30.10.2025  
**–í–µ—Ä—Å—ñ—è:** 1.0.0

